function scatterStandOutOnHover(){let hoveredTraceIndex=-1;let initialOpacity;const oxideListItems=document.querySelectorAll("#oxideList li");document.getElementById("myDiv").on("plotly_hover",function(data){const points=data.points;const pointIndex=points[0].pointIndex;hoveredTraceIndex=points[0].pointNumber;const datapoints=points[0].data.x.length;oxideListItems.forEach((li,index)=>{li.childNodes[0].nodeValue=li.childNodes[0].nodeValue.split(": ")[0]+": "+`${points[0].customdata[index+1]}`});initialOpacity=Array(datapoints).fill(.1);initialOpacity[pointIndex]=1});document.getElementById("myDiv").on("plotly_unhover",function(){oxideListItems.forEach((li,index)=>{li.childNodes[0].nodeValue=li.childNodes[0].nodeValue.split(": ")[0]+": "})})}function histogramStandOutOnHover(){let initialOpacity;document.getElementById("myDiv").on("plotly_hover",function(data){const points=data.points;const hoveredBinIndex=points[0].binNumber;const xbins=points[0].fullData.xbins;const binStart=xbins.start;const binEnd=xbins.end;const binSize=xbins.size;const numBins=Math.ceil((binEnd-binStart)/binSize);initialOpacity=Array(numBins).fill(.25);initialOpacity[hoveredBinIndex]=1;Plotly.restyle("myDiv",{"marker.opacity":[initialOpacity]})});document.getElementById("myDiv").on("plotly_unhover",function(data){Plotly.restyle("myDiv",{"marker.opacity":1})})}function assignOptions(textArray,xSelector,ySelector,propertySelector){for(let i=0;i<textArray.length;i++){const currentOption=document.createElement("option");currentOption.text=textArray[i];xSelector.appendChild(currentOption);const clonedOption=currentOption.cloneNode(true);ySelector.appendChild(clonedOption);if(i===1){clonedOption.setAttribute("selected","selected")}const clonedOption2=currentOption.cloneNode(true);propertySelector.appendChild(clonedOption2)}}function arraysAreEqual(arr1,arr2){if(arr1.length!==arr2.length){return false}for(let i=0;i<arr1.length;i++){if(arr1[i]!==arr2[i]){return false}}return true}function setScatterPlot(){const header=mapped_head.map(item=>item.title);const xAxisSelector=document.getElementById("xaxis");const yAxisSelector=document.getElementById("yaxis");const propertyOptionSelector=document.getElementById("propertyMenu");const xOtions=[...xAxisSelector].map(el=>el.value);const yOtions=[...yAxisSelector].map(el=>el.value);if(!arraysAreEqual(xOtions,selectedProps)||!arraysAreEqual(yOtions,selectedProps)){$("#xaxis").empty();$("#yaxis").empty();assignOptions(selectedProps,xAxisSelector,yAxisSelector,propertyOptionSelector)}let glassIDNumber=[];const data=[];let total;glassIDNumber=rawData.map(row=>row[header.indexOf("GlasNo")]).map(Number);const oxideList=document.getElementById("oxideList");oxideList.innerHTML="";selectedOxides.map(function(oxide,i){data[i]=rawData.map(x=>Number(x[header.indexOf(oxide)]));const li=document.createElement("li");li.className="list-group-item";li.appendChild(document.createTextNode(oxide+" (mol%): "));oxideList.appendChild(li)});total=rawData.map(x=>Number(x[header.indexOf("Total (mol%)")]));const li=document.createElement("li");li.className="list-group-item";li.appendChild(document.createTextNode("Total (mol%): "));oxideList.appendChild(li);const trace1={x:rawData.map(function(x){return x[header.indexOf(xAxisSelector.value)]}).map(Number),y:rawData.map(function(y){return y[header.indexOf(yAxisSelector.value)]}).map(Number),mode:"markers",type:"scatter",name:"",marker:{size:10,opacity:.75,line:{color:"black",width:1}},customdata:typeof selectedOxides!="undefined"?Array.from({length:data[0].length},(_,i)=>[glassIDNumber[i],...data.map(subArray=>subArray[i]),total[i]]):"",hovertemplate:`(%{x:.3f}, %{y:.3f})`+"<extra>GlasNo: %{customdata[0]}</extra>"};const traces=[trace1];const layout={title:{text:typeof selectedOxides!="undefined"?"<b>"+selectedOxides.join(" – ")+"</b>"+"<br>"+`${xAxisSelector.value} vs ${yAxisSelector.value}`:`${xAxisSelector.value} vs ${yAxisSelector.value}`,xref:"paper"},xaxis:{tickformat:".2f",title:xAxisSelector.value,automargin:true},yaxis:{tickformat:".2f",title:{text:yAxisSelector.value,standoff:20},automargin:true},hoverlabel:{bgcolor:"rgb(255,255,255)",namelength:-1,font:{size:16}}};const config={responsive:true};Plotly.newPlot("myDiv",traces,layout,config);scatterStandOutOnHover()}$("#scatter_plot").on("click",function(){if(typeof table=="undefined"){showToastMessage("warning","Please make a SPARQL query first")}else if(table.rows().count()===0){showToastMessage("warning","No data available in table")}else{OptionsToShowOrHide(["#xaxis","#yaxis","#oxideList"],["#propertyMenu","#glassIdMenu","#processParameterMenu"]);setScatterPlot();$("#xaxis, #yaxis").off("change").on("change",function(){setScatterPlot();$("#propertyMenu").val(this.value)})}});function setHistogramPlot(){const header=mapped_head.map(item=>item.title);const xAxisSelector=document.getElementById("xaxis");const yAxisSelector=document.getElementById("yaxis");const propertyOptionSelector=document.getElementById("propertyMenu");const xOtions=[...xAxisSelector].map(el=>el.value);const yOtions=[...yAxisSelector].map(el=>el.value);if(!arraysAreEqual(xOtions,selectedProps)||!arraysAreEqual(yOtions,selectedProps)){$("#xaxis").empty();$("#yaxis").empty();assignOptions(selectedProps,xAxisSelector,yAxisSelector,propertyOptionSelector)}let trace1={x:rawData.map(x=>{return Number(x[header.indexOf(xAxisSelector.value)])}),autobinx:false,marker:{color:"rgb(80, 158, 227)",line:{color:"rgb(255, 255, 255)",width:1}},type:"histogram",name:""};const traces=[trace1];const updatemenus=[];const layout={title:{text:typeof selectedOxides!="undefined"?"<b>"+selectedOxides.join(" – ")+"</b>"+"<br>"+`Histogram of ${xAxisSelector.value}`:`Histogram of ${xAxisSelector.value}`,xref:"paper"},xaxis:{tickformat:".2f",title:xAxisSelector.value,automargin:true},yaxis:{tickformat:"d",title:{text:"Count",standoff:20},automargin:true},barmode:"group",bargap:.15,bargroupgap:.1,hoverlabel:{bgcolor:"rgba(255,253,250,0.5)",namelength:-1,font:{size:16}},opacity:.75,updatemenus:updatemenus};const config={responsive:true};Plotly.newPlot("myDiv",traces,layout,config);histogramStandOutOnHover()}$("#histogram_plot").on("click",function(){if(typeof table=="undefined"){showToastMessage("warning","Please make a SPARQL query first")}else if(table.rows().count()===0){showToastMessage("warning","No data available in table")}else{OptionsToShowOrHide(["#xaxis"],["#yaxis","#oxideList","#propertyMenu","#glassIdMenu","#processParameterMenu"]);setHistogramPlot();$("#xaxis, #yaxis").off("change").on("change",function(){setHistogramPlot();$("#propertyMenu").val(this.value)})}});function setTernaryPlot(){const header=mapped_head.map(item=>item.title);const tdbId=window.location.href.split("/").pop();const data=[];selectedOxides.map(function(oxide,i){data[i]=rawData.map(x=>Number(x[header.indexOf(oxide)]))});const xAxisSelector=document.getElementById("xaxis");const yAxisSelector=document.getElementById("yaxis");const propertyOptionSelector=document.getElementById("propertyMenu");const options=[...propertyOptionSelector].map(el=>el.value);if(!arraysAreEqual(options,selectedProps)){$("#propertyMenu").empty();assignOptions(selectedProps,xAxisSelector,yAxisSelector,propertyOptionSelector)}let glassIDNumber=[];glassIDNumber=rawData.map(row=>row[header.indexOf("GlasNo")]).map(Number);const trace1={type:"scatterternary",mode:"markers",a:data[0],b:data[1],c:data[2],marker:{size:10,line:{color:"black",width:1},opacity:.5,color:propertyOptionSelector.value!==""?rawData.map(x=>Number(x[header.indexOf(propertyOptionSelector.value)])):"",colorbar:{title:propertyOptionSelector.value,xref:"paper",x:1.2}},customdata:glassIDNumber,hovertemplate:`<b>${propertyOptionSelector.value}: %{marker.color:.3f}</b><br>`+`GlasNo: %{customdata}<br>`+`${selectedOxides[0]}: %{a:.3f} mol%<br>`+`${selectedOxides[1]}: %{b:.3f} mol%<br>`+`${selectedOxides[2]}: %{c:.3f} mol%<br>`+"<extra></extra>"};const traces=[trace1];const layout={hoverlabel:{namelength:-1,font:{size:16}},ternary:{sum:100,aaxis:makeAxis(selectedOxides[0],0),baxis:makeAxis("<br>"+selectedOxides[1],0),caxis:makeAxis("<br>"+selectedOxides[2],0)}};function makeAxis(title,tickangle){return{title:title,ticksuffix:"%",titlefont:{size:20},tickangle:tickangle,tickfont:{size:15},tickcolor:"rgba(0,0,0,0)",ticks:"outside",ticklen:5,showline:true,showgrid:true}}const config={responsive:true};Plotly.newPlot("myDiv",traces,layout,config)}$("#ternary_plot").on("click",function(){if(typeof table=="undefined"){showToastMessage("warning","Please make a SPARQL query first")}else if(table.rows().count()===0){showToastMessage("warning","No data available in table")}else{OptionsToShowOrHide(["#propertyMenu"],["#xaxis","#yaxis","#glassIdMenu","#processParameterMenu"]);setTernaryPlot();$("#propertyMenu").off("change").on("change",function(){setTernaryPlot();$("#xaxis").val(this.value)})}});function OptionsToShowOrHide(showList,hideList){showList.forEach(function(id){$(id).parent().show()});hideList.forEach(function(id){$(id).parent().hide()})}